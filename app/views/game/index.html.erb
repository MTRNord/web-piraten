<% content_for :body_tag, 'data-no-turbolink' %>
<div class="row">

  <div class="col-md-4 code-wrapper">

      <div class="row code-controls pull-right">

          <div class="btn-group">
              <button type="button" class="btn btn-warning dropdown-toggle pull-right" id="watchlist-dropdown" data-toggle="dropdown">
                  Beobachtete Variablen <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" id='watchlist'>
                  <div id="watchlist-default">Mache einen Doppelklick auf Variablen zum Beobachten der Werte</div>
              </ul>
              <div id="watchlist-size">0</div>
          </div>

          <button type="button" class="btn btn-success" id="runBtn">
              <span class="glyphicon glyphicon-play"> </span> Ausführen
          </button>
      </div>
      <div class="row code-controls pull-right hidden" id="disabled-state-controls">
          <!--<button class="btn btn-default" id="resetBtn">-->
              <!--<span class="glyphicon glyphicon-step-backward"> </span> Reset-->
          <!--</button>-->
          <button class="btn btn-default" id="stopBtn">
              <span class="glyphicon glyphicon-stop"> </span> Stop
          </button>
          <!--<button class="btn btn-default" id="pauseBtn">-->
              <!--<span class="glyphicon glyphicon-pause"> </span> Pause-->
          <!--</button>-->
          <!--<button class="btn btn-default" id="stepBtn">-->
              <!--<span class="glyphicon glyphicon-step-forward"> </span> Schritt-->
          <!--</button>-->
      </div>
      <div class="clearfix"></div>
      <div class="row">

<!-- no indentation because CodeMirror would display it -->
<textarea id="codemirror" style="display: none">
print "Hallo Welt!"
i = 0
(1..3).each do
  print "Durchlauf #{i}"
  move
  turn(:right)
  turn(:left)
  turn(:back)
  turn
  look
  look(:right)
  look(:left)
  look(:back)
  look(:here)
  look(:front)
  put
  take
  i += 1
end
</textarea>
          <div id="codeMirror-loading">
              <%= image_tag 'ajax-loader.gif' %> Lade Daten
          </div>
        </div>
  </div>
  <div class="col-md-8 grid-wrapper">
      <div class="grid-controls">
          <div class="speed-controls">
              Geschwindigkeit:
              <span id="simulationSpeed"></span>
              <div id="speedSlider" style="width: 200px"></div>
          </div>
          <div class="grid-resetter">
              <!--<button class="btn btn-default" id="resetGrid">-->
                  <!--<span class="glyphicon glyphicon-step-backward"> </span> Reset-->
              <!--</button>-->
          </div>


          <div class="btn-group serialization-controls">
              <div class="btn btn-default" data-toggle="modal" data-target="#serialization-modal">
                  <span class="glyphicon glyphicon-floppy-disk"> </span>
              </div>
              <!--<div class="btn btn-default" data-toggle="modal" data-target="#serialization-modal">-->
                  <!--<span class="glyphicon glyphicon-floppy-open"> </span>-->
              <!--</div>-->
          </div>
          <div class="btn-group gameObject-controls">
              <button class=" btn btn-default" id="addTreasure">
                  <span class="glyphicon glyphicon-arrow-left"> </span> Schatz
              </button>
              <button class=" btn btn-default" id="addMonster">
                  <span class="glyphicon glyphicon-arrow-up"> </span> Kraken
              </button>
              <button class=" btn btn-default" id="addWave">
                  <span class="glyphicon glyphicon-arrow-right"> </span> Welle
              </button>
          </div>
      </div>

      <div id="gridData" style="display: none" hidden>
      {
        "width":21,
        "height":10,
        "objects":[],
        "ship":{
          "name":"ship",
          "x":5,
          "y":3,
          "rotation":0
        }
      }
      </div>
      <canvas width="700" height="350" id="pirateGrid">Your browser is not supported!</canvas>
  </div>
</div>
<div class="row">
    <div class="col-md-4">
        <h4>Beobachtete Variablen</h4>
        <div id="watchlistDebugger">
            <table class="table table-hover table-condensed table-striped table-responsive">
                <thead>
                  <tr>
                      <th>Variable</th>
                      <th>Belegung</th>
                  </tr>
                </thead>
                <tbody> <%# Required to properly set allocations the first time %>
                </tbody>
            </table>
        </div>
    </div>
    <div class="col-md-8">
        <h4>
            <%= t("game.console.label") %>:
            <span class="pull-right glyphicon glyphicon-trash" id="clearConsoleBtn" title="Konsole leeren"></span>
        </h4>
        <div name="console" id="console"> </div>
    </div>
</div>

<!-- Serialization Modal -->
<div class="modal fade" id="serialization-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">Laden und Speichern</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h4>Code</h4>
                        <div class="btn-group">
                          <a class="btn btn-success" download="webpiraten-code.rb" id="save-code">
                              <span class="glyphicon glyphicon-floppy-save"> speichern</span>
                          </a>

                          <a class="btn btn-primary" id="load-code">
                              <span class="glyphicon glyphicon-floppy-open"> laden</span>
                          </a>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h4>Spielwelt</h4>
                        <div class="btn-group">
                          <a class="btn btn-success" download="webpiraten-welt.world" id="save-grid">
                              <span class="glyphicon glyphicon-floppy-save"> speichern</span>
                          </a>

                          <a class="btn btn-primary" id="load-grid">
                              <span class="glyphicon glyphicon-floppy-open"> laden</span>
                          </a>
                        </div>
                    </div>
                    <!--<input type="file" id="fileUploader" style="display: none">-->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Schließen</button>
            </div>
        </div>
    </div>
</div>

<div id="imagePreloader" style="display: none" hidden></div>
<% content_for :html_header, javascript_include_tag('pirates/simulation', 'data-turbolinks-track' => false) %>
<%= stylesheet_link_tag 'game'%>